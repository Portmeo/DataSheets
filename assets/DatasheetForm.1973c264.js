import{g as q,a as Q,s as Z,b as k,r as M,u as ee,_ as ae,j as n,c as ne,d as se,ah as te,A as Y,x as oe,e as v,v as h,T,C as t,I as K}from"./index.6f93e526.js";import{D as A,i as ie,M as re,T as le}from"./datasheet.service.34ebce9b.js";import{C as ce}from"./category.service.3dcca593.js";import{F as p,T as g,I as me,S as de,O as pe}from"./TextField.03784409.js";import{B as ue}from"./requestHandler.service.859e2cde.js";import"./Tooltip.5896dceb.js";function he(a){return q("MuiCardMedia",a)}Q("MuiCardMedia",["root","media","img"]);const ge=["children","className","component","image","src","style"],Ce=a=>{const{classes:C,isMediaComponent:u,isImageComponent:x}=a;return se({root:["root",u&&"media",x&&"img"]},he,C)},xe=Z("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(a,C)=>{const{ownerState:u}=a,{isMediaComponent:x,isImageComponent:c}=u;return[C.root,x&&C.media,c&&C.img]}})(({ownerState:a})=>k({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},a.isMediaComponent&&{width:"100%"},a.isImageComponent&&{objectFit:"cover"})),ve=["video","audio","picture","iframe","img"],fe=["picture","img"],we=M.exports.forwardRef(function(C,u){const x=ee({props:C,name:"MuiCardMedia"}),{children:c,className:y,component:e="div",image:d,src:S,style:E}=x,f=ae(x,ge),i=ve.indexOf(e)!==-1,b=!i&&d?k({backgroundImage:`url("${d}")`},E):E,D=k({},x,{component:e,isMediaComponent:i,isImageComponent:fe.indexOf(e)!==-1}),I=Ce(D);return n(xe,k({className:ne(I.root,y),as:e,role:!i&&d?"img":void 0,ref:u,style:b,ownerState:D,src:i?d||S:void 0},f,{children:c}))}),Me=we,ye=()=>{const{id:a}=te(),[C,u]=M.exports.useState(),[x,c]=M.exports.useState([]),[y,e]=M.exports.useState([]),[d,S]=M.exports.useState({name:"",value:0}),E=async()=>{const m=await ce.getAll();m&&c(m)},f=async m=>{const r=await A.get(m);r&&(u(r),e(r.categories.map(w=>w._id)))},i=()=>{u({expenses:0,weight:0,workmanship:[{name:"Fundicion",value:0},{name:"Repasado",value:0},{name:"Plateado",value:0},{name:"Tallado",value:0}],metals:{silver:{price:0},gold:{price:0}}})},b=async m=>{await A.create(N(m))&&(u(void 0),e([]),S({name:"",value:0}),I(),i())},D=async m=>{await A.update(N(m))&&I()},I=()=>{Y.proccesSuccess()},N=m=>{const r=JSON.parse(JSON.stringify(m));return r.metals.silver.price=+r.metals.silver.price,r.metals.gold&&(r.metals.gold.price=+m.metals.gold.price),r.workmanship.forEach(w=>{w.value=+w.value}),r};return M.exports.useEffect(()=>{E(),a&&a!=="new"&&f(a),a&&a==="new"&&i()},[]),M.exports.useEffect(()=>()=>{Y.reset()},[]),{categoryOptions:x,categorySelect:y,setCategorySelect:e,workmanship:d,setWorkmanship:S,datasheet:C,setDatasheet:u,createDatasheet:b,updateDatasheet:D,id:a}};const Se=a=>a?a.charAt(0).toUpperCase()+a.slice(1):"",Ee=48,be=8,De={PaperProps:{style:{maxHeight:Ee*4.5+be,width:250}}},Pe=()=>{var w,P,W,z,G,R,F,U,_,L,j,H,B,V,$,J;const{t:a}=oe(),{categoryOptions:C,categorySelect:u,setCategorySelect:x,workmanship:c,setWorkmanship:y,datasheet:e,setDatasheet:d,createDatasheet:S,updateDatasheet:E,id:f}=ye(),i=s=>o=>{const l={...e&&{...e},[s]:o.target.value};d(l)},b=s=>o=>{const[l,O]=s.split("."),X={...e,metals:{...e.metals,[l]:{[O]:o.target.value}}};d(X)},D=s=>{const{target:{value:o}}=s,l={...e,categories:o};d(l),x(typeof o=="string"?o.split(","):o)},I=s=>{const o={...e,workmanship:e.workmanship.filter(l=>l.name!==s)};d(o)},N=s=>o=>{const l={...c,[s]:s==="value"?o.target.value:Se(o.target.value.toLowerCase())};y(l)},m=s=>o=>{const l=e.workmanship;l[s].value=o.target.value;const O={...e,workmanship:l};d(O)},r=()=>{const s=e.workmanship?[...e.workmanship,c]:[c],o={...e,workmanship:s};y({name:"",value:0}),d(o)};return v(h,{children:[v(h,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",sx:{gap:2,flexDirection:{xs:"column",md:"row",lg:"row"}},children:[v(h,{display:"flex",sx:{mt:1,flexDirection:"column",alignItems:"center"},children:[n(T,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2",mb:2},children:a(t.IMAGE)}),n(Me,{sx:{width:300,height:300},component:"img",image:(w=e==null?void 0:e.image)!=null?w:ie,alt:"img"}),n(p,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(t.IMAGE),value:(P=e==null?void 0:e.image)!=null?P:"",onChange:i("image")})})]}),v(h,{sx:{mt:1,width:{xs:"100%",md:"30%",lg:"30%"}},children:[n(T,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:a(t.DATA)}),n(p,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(t.CODE),value:(W=e==null?void 0:e.code)!=null?W:"",onChange:i("code")})}),n(p,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(t.NAME),value:(z=e==null?void 0:e.name)!=null?z:"",onChange:i("name")})}),n(p,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(t.MODEL),value:(G=e==null?void 0:e.model)!=null?G:"",onChange:i("model")})}),n(p,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(t.DESCRIPTION),value:(R=e==null?void 0:e.description)!=null?R:"",onChange:i("description")})}),v(p,{fullWidth:!0,margin:"normal",children:[n(me,{size:"small",id:"category-label",children:a(t.CATEGORY)}),n(de,{size:"small",labelId:"category-label",id:"category",multiple:!0,value:u,onChange:D,input:n(pe,{label:a(t.CATEGORY)}),MenuProps:De,children:C.map(s=>n(re,{value:s._id,children:s.name.toUpperCase()},s._id))})]}),n(p,{sx:{width:"49%",mr:"1%"},margin:"normal",children:n(g,{size:"small",label:a(t.EXPENSES),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(F=e==null?void 0:e.expenses)!=null?F:"",onChange:i("expenses")})}),n(p,{sx:{width:"49%",ml:"1%"},margin:"normal",children:n(g,{size:"small",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},label:a(t.WEIGHT),value:(U=e==null?void 0:e.weight)!=null?U:"",onChange:i("weight")})}),n(p,{sx:{width:"49%",mr:"1%"},margin:"normal",children:n(g,{size:"small",label:a(t.SILVER),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(j=(L=(_=e==null?void 0:e.metals)==null?void 0:_.silver)==null?void 0:L.price)!=null?j:"",onChange:b("silver.price")})}),n(p,{sx:{width:"49%",ml:"1%"},margin:"normal",children:n(g,{size:"small",label:a(t.GOLD),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(V=(B=(H=e==null?void 0:e.metals)==null?void 0:H.gold)==null?void 0:B.price)!=null?V:"",onChange:b("gold.price")})})]}),v(h,{sx:{mt:1,width:{xs:"100%",md:"35%",lg:"35%"}},children:[n(T,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:a(t.WORKMANSHIPS)}),v(h,{display:"flex",justifyContent:"space-between",children:[v(h,{display:"flex",justifyContent:"space-between",sx:{width:"90%"},children:[n(p,{sx:{width:"49%"},margin:"normal",children:n(g,{size:"small",label:a(t.NAME),value:c.name,onChange:N("name")})}),n(p,{sx:{width:"49%"},margin:"normal",size:"small",children:n(g,{size:"small",label:a(t.VALUE),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:($=c.value)!=null?$:"",onChange:N("value")})})]}),n(K,{disabled:!c.name||!c.value,sx:{width:"10%"},onClick:r,children:t.ICONS.ADD})]}),(J=e==null?void 0:e.workmanship)==null?void 0:J.map((s,o)=>{var l;return v(h,{display:"flex","align-item":"center",children:[v(h,{className:"row",children:[n(h,{className:"column",children:s.name}),n(p,{className:"value",margin:"normal",size:"small",children:n(g,{size:"small",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(l=s.value)!=null?l:"",onChange:m(o)})})]}),n(K,{className:"delete",sx:{padding:0,mb:"10px",width:"10%"},onClick:()=>I(s.name),children:t.ICONS.DELETE},s.name)]},s.name)})]}),v(h,{sx:{mt:1,width:{xs:"100%",md:"25%",lg:"25%"}},children:[n(T,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2",mb:2},children:a(t.RESULT)}),n(le,{datasheet:e})]})]}),n(h,{display:"flex",justifyContent:"flex-end",children:n(ue,{disabled:!e,sx:{mt:1},variant:"contained",onClick:()=>(f==null?void 0:f.toUpperCase())===t.NEW.toUpperCase()?S(e):E(e),children:(f==null?void 0:f.toUpperCase())===t.NEW.toUpperCase()?a(t.CREATE):a(t.EDIT)})})]})};export{Pe as DatasheetForm};
