import{ae as $,r as v,A as V,k as q,e as p,B as i,j as a,C as l,T as J,I as Y,m as Q}from"./index.7873cacd.js";import{D as N,C as Z,i as ee,M as ae}from"./datasheet.service.284d7fe8.js";import{C as te}from"./category.service.912c1a9c.js";import{F as c,T as d,I as ne,S as se,O as le}from"./TextField.5fff4129.js";import"./requestHandler.service.baa34922.js";const re=()=>{const{id:n}=$(),[S,w]=v.exports.useState(),[b,h]=v.exports.useState([]),[f,e]=v.exports.useState([]),[u,y]=v.exports.useState({name:"",value:0}),k=async()=>{const o=await te.getAll();o&&h(o)},g=async o=>{const C=await N.get(o);C&&(w(C),e(C.categories.map(T=>T._id)))},x=()=>{w({workmanship:[{name:"Fundicion",value:0},{name:"Repasado",value:0},{name:"Plateado",value:0},{name:"Tallado",value:0}]})},D=async o=>{await N.create(o)&&(w(void 0),e([]),y({name:"",value:0}),E())},I=async o=>{await N.update(o)&&E()},E=()=>{V.proccesSuccess()};return v.exports.useEffect(()=>{k(),n&&n!=="new"&&g(n),n&&n==="new"&&x()},[]),v.exports.useEffect(()=>()=>{V.reset()},[]),{categoryOptions:b,categorySelect:f,setCategorySelect:e,workmanship:u,setWorkmanship:y,datasheet:S,setDatasheet:w,createDatasheet:D,updateDatasheet:I,id:n}};const oe=n=>n?n.charAt(0).toUpperCase()+n.slice(1):"",ie=48,ce=8,me={PaperProps:{style:{maxHeight:ie*4.5+ce,width:250}}},Ce=()=>{var z,W,O,F,M,P,U,L,R,j,G,B,_,H;const{t:n}=q(),{categoryOptions:S,categorySelect:w,setCategorySelect:b,workmanship:h,setWorkmanship:f,datasheet:e,setDatasheet:u,createDatasheet:y,updateDatasheet:k,id:g}=re(),x=t=>s=>{const r={...e&&{...e},[t]:s.target.value};u(r)},D=t=>s=>{const[r,m]=t.split("."),A={...e,metals:{...e.metals,[r]:{[m]:+s.target.value}}};u(A)},I=t=>{const{target:{value:s}}=t,r={...e,categories:s};u(r),b(typeof s=="string"?s.split(","):s)},E=t=>{const s={...e,workmanship:e.workmanship.filter(r=>r.name!==t)};u(s)},o=t=>s=>{const r={...h,[t]:t==="value"?+s.target.value:oe(s.target.value.toLowerCase())};f(r)},C=t=>s=>{const r=e.workmanship;r[t].value=+s.target.value;const m={...e,workmanship:r};u(m)},T=()=>{const t=e.workmanship?[...e.workmanship,h]:[h],s={...e,workmanship:t};f({name:"",value:0}),u(s)},K=t=>new Promise((s,r)=>{const m=new FileReader;m.readAsDataURL(t),m.onload=()=>s(m.result),m.onerror=A=>r(A)}),X=async t=>{const s=t.target.files[0],r=await K(s),m={...e,image:r};u(m)};return p(i,{children:[p(i,{display:"flex",justifyContent:"space-between",sx:{gap:2},children:[p(i,{display:"flex",sx:{mt:2,flexDirection:"column",alignItems:"center"},children:[a(Z,{sx:{width:300,height:300},component:"img",image:(z=e==null?void 0:e.image)!=null?z:ee,alt:"img"}),a(c,{margin:"normal",children:a(d,{size:"small",type:"file",onChange:X})})]}),p(i,{sx:{mt:1,width:"30%"},children:[a(c,{fullWidth:!0,margin:"normal",children:a(d,{size:"small",label:n(l.CODE),value:(O=(W=e==null?void 0:e.code)==null?void 0:W.toUpperCase())!=null?O:"",onChange:x("code")})}),a(c,{fullWidth:!0,margin:"normal",children:a(d,{size:"small",label:n(l.NAME),value:(M=(F=e==null?void 0:e.name)==null?void 0:F.toUpperCase())!=null?M:"",onChange:x("name")})}),p(c,{fullWidth:!0,margin:"normal",children:[a(ne,{size:"small",id:"category-label",children:n(l.CATEGORY)}),a(se,{size:"small",labelId:"category-label",id:"category",multiple:!0,value:w,onChange:I,input:a(le,{label:n(l.CATEGORY)}),MenuProps:me,children:S.map(t=>a(ae,{value:t._id,children:t.name.toUpperCase()},t._id))})]}),a(c,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(d,{size:"small",label:n(l.EXPENSES),value:(P=e==null?void 0:e.expenses)!=null?P:"",onChange:x("expenses")})}),a(c,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(d,{size:"small",label:n(l.WEIGHT),value:(U=e==null?void 0:e.weight)!=null?U:"",onChange:x("weight")})}),a(c,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(d,{size:"small",label:n(l.SILVER),type:"number",value:(j=(R=(L=e==null?void 0:e.metals)==null?void 0:L.silver)==null?void 0:R.price)!=null?j:"",onChange:D("silver.price")})}),a(c,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(d,{size:"small",label:n(l.GOLD),type:"number",value:(_=(B=(G=e==null?void 0:e.metals)==null?void 0:G.gold)==null?void 0:B.price)!=null?_:"",onChange:D("gold.price")})})]}),p(i,{sx:{mt:1,width:"35%"},children:[a(J,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:n(l.WORKMANSHIPS)}),p(i,{display:"flex",justifyContent:"space-between",children:[p(i,{display:"flex",justifyContent:"space-between",sx:{width:"90%"},children:[a(c,{sx:{width:"49%"},margin:"normal",children:a(d,{size:"small",label:n(l.NAME),value:h.name,onChange:o("name")})}),a(c,{sx:{width:"49%"},margin:"normal",size:"small",children:a(d,{size:"small",label:n(l.VALUE),type:"number",value:h.value,onChange:o("value")})})]}),a(Y,{disabled:!h.name||!h.value,sx:{width:"10%"},onClick:T,children:l.ICONS.ADD})]}),(H=e==null?void 0:e.workmanship)==null?void 0:H.map((t,s)=>p(i,{display:"flex","align-item":"center",children:[p(i,{className:"row",children:[a(i,{className:"column",children:t.name}),a(c,{className:"value",margin:"normal",size:"small",children:a(d,{size:"small",type:"number",value:t.value,onChange:C(s)})})]}),a(Y,{className:"delete",sx:{padding:0,mb:"10px",width:"10%"},onClick:()=>E(t.name),children:l.ICONS.DELETE},t.name)]},t.name))]})]}),a(i,{display:"flex",justifyContent:"flex-end",children:a(Q,{disabled:!e,sx:{mt:1},variant:"contained",onClick:()=>(g==null?void 0:g.toUpperCase())===l.NEW.toUpperCase()?y(e):k(e),children:(g==null?void 0:g.toUpperCase())===l.NEW.toUpperCase()?n(l.CREATE):n(l.EDIT)})})]})};export{Ce as DatasheetForm};
