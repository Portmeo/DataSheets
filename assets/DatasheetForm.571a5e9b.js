import{a5 as J,r as x,A as H,e as i,B as l,j as a,T as V,I as L,C,l as $}from"./index.d2ed0200.js";import{D as z,C as q,i as K,M as Q}from"./datasheet.service.9bb68098.js";import{C as X}from"./category.service.f3c9f111.js";import{F as m,T as h,I as Y,S as Z,O as ee}from"./TextField.92efc9d6.js";import"./requestHandler.service.2a88de81.js";import"./Menu.b1891301.js";const ae=()=>{const{id:g}=J(),[b,w]=x.exports.useState(),[c,y]=x.exports.useState([]),[e,o]=x.exports.useState([]),[I,v]=x.exports.useState({name:"",value:0}),p=async()=>{const r=await X.getAll();r&&y(r)},f=async r=>{const u=await z.get(r);u&&(w(u),o(u.categories.map(T=>T.id)))},D=async r=>{await z.create(r)&&(w(void 0),o([]),v({name:"",value:0}),S())},k=async r=>{await z.update(r)&&S()},S=()=>{H.proccesSuccess()};return x.exports.useEffect(()=>{p(),g&&g!=="new"&&f(g)},[]),x.exports.useEffect(()=>()=>{H.reset()},[]),{categoryOptions:c,categorySelect:e,setCategorySelect:o,workmanship:I,setWorkmanship:v,datasheet:b,setDatasheet:w,createDatasheet:D,updateDatasheet:k,id:g}};const te=48,se=8,ne={PaperProps:{style:{maxHeight:te*4.5+se,width:250}}},pe=()=>{var A,F,N,O,W,P,j,B,M,U,R,G;const{categoryOptions:g,categorySelect:b,setCategorySelect:w,workmanship:c,setWorkmanship:y,datasheet:e,setDatasheet:o,createDatasheet:I,updateDatasheet:v,id:p}=ae(),f=t=>s=>{const n={...e&&{...e},[t]:s.target.value};o(n)},D=t=>s=>{const[n,d]=t.split("."),E={...e,metals:{...e.metals,[n]:{[d]:+s.target.value}}};o(E)},k=t=>{const{target:{value:s}}=t,n={...e,categories:s};o(n),w(typeof s=="string"?s.split(","):s)},S=t=>{const s={...e,workmanship:e.workmanship.filter(n=>n.name!==t)};o(s)},r=t=>s=>{const n={...c,[t]:t==="value"?+s.target.value:s.target.value};y(n)},u=()=>{const t=e.workmanship?[...e.workmanship,c]:[c],s={...e,workmanship:t};y({name:"",value:0}),o(s)},T=t=>new Promise((s,n)=>{const d=new FileReader;d.readAsDataURL(t),d.onload=()=>s(d.result),d.onerror=E=>n(E)}),_=async t=>{const s=t.target.files[0],n=await T(s),d={...e,image:n};o(d)};return i(l,{children:[i(l,{display:"flex",justifyContent:"space-between",sx:{gap:2},children:[i(l,{display:"flex",sx:{mt:2,flexDirection:"column",alignItems:"center"},children:[a(q,{sx:{width:300,height:300},component:"img",image:(A=e==null?void 0:e.image)!=null?A:K,alt:"img"}),a(m,{margin:"normal",children:a(h,{size:"small",type:"file",onChange:_})})]}),i(l,{sx:{mt:1,width:"30%"},children:[a(m,{fullWidth:!0,margin:"normal",children:a(h,{size:"small",label:"C\xF3digo",value:(N=(F=e==null?void 0:e.code)==null?void 0:F.toUpperCase())!=null?N:"",onChange:f("code")})}),i(m,{fullWidth:!0,margin:"normal",children:[a(Y,{size:"small",id:"category-label",children:"Category"}),a(Z,{size:"small",labelId:"category-label",id:"category",multiple:!0,value:b,onChange:k,input:a(ee,{label:"Category"}),MenuProps:ne,children:g.map(t=>a(Q,{value:t.id,children:t.name.toUpperCase()},t.id))})]}),a(m,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(h,{size:"small",label:"expenses",value:(O=e==null?void 0:e.expenses)!=null?O:"",onChange:f("expenses")})}),a(m,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(h,{size:"small",label:"weight",value:(W=e==null?void 0:e.weight)!=null?W:"",onChange:f("weight")})}),a(m,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(h,{size:"small",label:"Plata",value:(B=(j=(P=e==null?void 0:e.metals)==null?void 0:P.silver)==null?void 0:j.price)!=null?B:"",onChange:D("silver.price")})}),a(m,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(h,{size:"small",label:"Oro",value:(R=(U=(M=e==null?void 0:e.metals)==null?void 0:M.gold)==null?void 0:U.price)!=null?R:"",onChange:D("gold.price")})})]}),i(l,{sx:{mt:1,width:"35%"},children:[a(V,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:"TRABAJOS"}),i(l,{display:"flex",justifyContent:"space-between",children:[i(l,{display:"flex",justifyContent:"space-between",sx:{width:"90%"},children:[a(m,{sx:{width:"49%"},margin:"normal",children:a(h,{size:"small",label:"Work",value:c.name,onChange:r("name")})}),a(m,{sx:{width:"49%"},margin:"normal",size:"small",children:a(h,{size:"small",label:"Value",type:"number",value:c.value,onChange:r("value")})})]}),a(L,{disabled:!c.name||!c.value,sx:{width:"10%"},onClick:u,children:C.ICONS.ADD})]}),(G=e==null?void 0:e.workmanship)==null?void 0:G.map(t=>i(l,{display:"flex","align-item":"center",children:[i(l,{className:"row",children:[a(l,{className:"column",children:t.name}),a(l,{className:"column text-rigth",children:t.value})]}),a(L,{sx:{padding:0,mb:"10px",width:"10%"},onClick:()=>S(t.name),children:C.ICONS.DELETE},t.name)]},t.name))]})]}),a(l,{display:"flex",justifyContent:"flex-end",children:a($,{disabled:!e,sx:{mt:1},variant:"contained",onClick:()=>(p==null?void 0:p.toUpperCase())===C.NEW.toUpperCase()?I(e):v(e),children:(p==null?void 0:p.toUpperCase())===C.NEW.toUpperCase()?C.CREATE:C.EDIT})})]})};export{pe as DatasheetForm};
