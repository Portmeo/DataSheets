import{ae as q,r as v,A as Y,k as J,e as d,B as c,j as a,C as l,T as Q,I as K,m as Z}from"./index.52e05649.js";import{D as z,C as ee,i as ae,M as ne}from"./datasheet.service.e3466d23.js";import{C as se}from"./category.service.b7348ad9.js";import{F as o,T as m,I as te,S as le,O as re}from"./TextField.b2f794fe.js";import"./requestHandler.service.b01a4775.js";const ie=()=>{const{id:s}=q(),[S,x]=v.exports.useState(),[b,h]=v.exports.useState([]),[f,e]=v.exports.useState([]),[u,y]=v.exports.useState({name:"",value:0}),k=async()=>{const i=await se.getAll();i&&h(i)},g=async i=>{const w=await z.get(i);w&&(x(w),e(w.categories.map(T=>T._id)))},C=()=>{x({workmanship:[{name:"Fundicion",value:0},{name:"Repasado",value:0},{name:"Plateado",value:0},{name:"Tallado",value:0}]})},D=async i=>{await z.create(i)&&(x(void 0),e([]),y({name:"",value:0}),E())},I=async i=>{await z.update(i)&&E()},E=()=>{Y.proccesSuccess()};return v.exports.useEffect(()=>{k(),s&&s!=="new"&&g(s),s&&s==="new"&&C()},[]),v.exports.useEffect(()=>()=>{Y.reset()},[]),{categoryOptions:b,categorySelect:f,setCategorySelect:e,workmanship:u,setWorkmanship:y,datasheet:S,setDatasheet:x,createDatasheet:D,updateDatasheet:I,id:s}};const oe=s=>s?s.charAt(0).toUpperCase()+s.slice(1):"",ce=48,me=8,pe={PaperProps:{style:{maxHeight:ce*4.5+me,width:250}}},we=()=>{var A,W,O,F,P,M,U,R,L,j,G,B,_,H,V;const{t:s}=J(),{categoryOptions:S,categorySelect:x,setCategorySelect:b,workmanship:h,setWorkmanship:f,datasheet:e,setDatasheet:u,createDatasheet:y,updateDatasheet:k,id:g}=ie(),C=n=>t=>{const r={...e&&{...e},[n]:t.target.value};u(r)},D=n=>t=>{const[r,p]=n.split("."),N={...e,metals:{...e.metals,[r]:{[p]:+t.target.value}}};u(N)},I=n=>{const{target:{value:t}}=n,r={...e,categories:t};u(r),b(typeof t=="string"?t.split(","):t)},E=n=>{const t={...e,workmanship:e.workmanship.filter(r=>r.name!==n)};u(t)},i=n=>t=>{const r={...h,[n]:n==="value"?+t.target.value:oe(t.target.value.toLowerCase())};f(r)},w=n=>t=>{const r=e.workmanship;r[n].value=+t.target.value;const p={...e,workmanship:r};u(p)},T=()=>{const n=e.workmanship?[...e.workmanship,h]:[h],t={...e,workmanship:n};f({name:"",value:0}),u(t)},X=n=>new Promise((t,r)=>{const p=new FileReader;p.readAsDataURL(n),p.onload=()=>t(p.result),p.onerror=N=>r(N)}),$=async n=>{const t=n.target.files[0],r=await X(t),p={...e,image:r};u(p)};return d(c,{children:[d(c,{display:"flex",justifyContent:"space-between",sx:{gap:2},children:[d(c,{display:"flex",sx:{mt:2,flexDirection:"column",alignItems:"center"},children:[a(ee,{sx:{width:300,height:300},component:"img",image:(A=e==null?void 0:e.image)!=null?A:ae,alt:"img"}),a(o,{margin:"normal",children:a(m,{size:"small",type:"file",onChange:$})})]}),d(c,{sx:{mt:1,width:"30%"},children:[a(o,{fullWidth:!0,margin:"normal",children:a(m,{size:"small",label:s(l.CODE),value:(O=(W=e==null?void 0:e.code)==null?void 0:W.toUpperCase())!=null?O:"",onChange:C("code")})}),a(o,{fullWidth:!0,margin:"normal",children:a(m,{size:"small",label:s(l.NAME),value:(P=(F=e==null?void 0:e.name)==null?void 0:F.toUpperCase())!=null?P:"",onChange:C("name")})}),a(o,{fullWidth:!0,margin:"normal",children:a(m,{size:"small",label:s(l.DESCRIPTION),value:(M=e==null?void 0:e.description)!=null?M:"",onChange:C("description")})}),d(o,{fullWidth:!0,margin:"normal",children:[a(te,{size:"small",id:"category-label",children:s(l.CATEGORY)}),a(le,{size:"small",labelId:"category-label",id:"category",multiple:!0,value:x,onChange:I,input:a(re,{label:s(l.CATEGORY)}),MenuProps:pe,children:S.map(n=>a(ne,{value:n._id,children:n.name.toUpperCase()},n._id))})]}),a(o,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(m,{size:"small",label:s(l.EXPENSES),value:(U=e==null?void 0:e.expenses)!=null?U:"",onChange:C("expenses")})}),a(o,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(m,{size:"small",label:s(l.WEIGHT),value:(R=e==null?void 0:e.weight)!=null?R:"",onChange:C("weight")})}),a(o,{sx:{width:"49%",mr:"1%"},margin:"normal",children:a(m,{size:"small",label:s(l.SILVER),type:"number",value:(G=(j=(L=e==null?void 0:e.metals)==null?void 0:L.silver)==null?void 0:j.price)!=null?G:"",onChange:D("silver.price")})}),a(o,{sx:{width:"49%",ml:"1%"},margin:"normal",children:a(m,{size:"small",label:s(l.GOLD),type:"number",value:(H=(_=(B=e==null?void 0:e.metals)==null?void 0:B.gold)==null?void 0:_.price)!=null?H:"",onChange:D("gold.price")})})]}),d(c,{sx:{mt:1,width:"35%"},children:[a(Q,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:s(l.WORKMANSHIPS)}),d(c,{display:"flex",justifyContent:"space-between",children:[d(c,{display:"flex",justifyContent:"space-between",sx:{width:"90%"},children:[a(o,{sx:{width:"49%"},margin:"normal",children:a(m,{size:"small",label:s(l.NAME),value:h.name,onChange:i("name")})}),a(o,{sx:{width:"49%"},margin:"normal",size:"small",children:a(m,{size:"small",label:s(l.VALUE),type:"number",value:h.value,onChange:i("value")})})]}),a(K,{disabled:!h.name||!h.value,sx:{width:"10%"},onClick:T,children:l.ICONS.ADD})]}),(V=e==null?void 0:e.workmanship)==null?void 0:V.map((n,t)=>d(c,{display:"flex","align-item":"center",children:[d(c,{className:"row",children:[a(c,{className:"column",children:n.name}),a(o,{className:"value",margin:"normal",size:"small",children:a(m,{size:"small",type:"number",value:n.value,onChange:w(t)})})]}),a(K,{className:"delete",sx:{padding:0,mb:"10px",width:"10%"},onClick:()=>E(n.name),children:l.ICONS.DELETE},n.name)]},n.name))]})]}),a(c,{display:"flex",justifyContent:"flex-end",children:a(Z,{disabled:!e,sx:{mt:1},variant:"contained",onClick:()=>(g==null?void 0:g.toUpperCase())===l.NEW.toUpperCase()?y(e):k(e),children:(g==null?void 0:g.toUpperCase())===l.NEW.toUpperCase()?s(l.CREATE):s(l.EDIT)})})]})};export{we as DatasheetForm};
